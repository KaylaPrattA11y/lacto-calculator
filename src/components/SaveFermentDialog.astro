<dialog id="saveFermentDialog">
  <div class="dialog-header">
    <h2>Save this ferment</h2>
    <button aria-controls="saveFermentDialog" aria-haspopup="dialog" aria-label="Close" class="btn-default">
      <kay-icon class="carbon:close" aria-hidden="true"></kay-icon>
    </button>
  </div>
  <form class="dialog-main" id="saveFermentForm">
    <ul class="input-group ferment-details">
      <li>
        <label for="currentBrine">Brine: </label>
        <output id="currentBrine" data-label="brine"></output>
        <span class="ferment-unit">%</span>
      </li>
      <li>
        <label for="currentWeight">Weight: </label>
        <output id="currentWeight" data-label="weight"></output>
        <span data-label="unit" class="ferment-unit"></span>
      </li>
      <li>
        <label for="currentSalt">Salt: </label>
        <output id="currentSalt" data-label="salt"></output>
        <span data-label="unit" class="ferment-unit"></span>
      </li>
    </ul>
    <div class="input-group">
      <label for="dateStart">End date (optional)</label>
      <input type="date" id="dateEnd" name="dateEnd" />
      <p data-validate="field">End date must be later than today's date.</p>
    </div>
    <div class="input-group">
      <label for="fermentName">Name (optional)</label>
      <input 
      type="text" 
      id="fermentName" 
      maxlength="30" 
      pattern="^[a-zA-Z0-9 ]{1,30}$" 
      title="Please use only letters, numbers, and spaces." 
      name="fermentName" />
      <p data-validate="field">Please use only letters, numbers, and spaces.</p>
    </div>
    <div class="input-group">
      <label for="notes">Notes (optional)</label>
      <textarea id="notes" name="notes" maxlength="100"></textarea>
    </div>
    <fieldset class="input-group">
      <legend>Tag with a color (optional)</legend>
      <label class="theme-transparent">
        <span class="visually-hidden">transparent</span>
        <input type="radio" name="color" value="transparent" checked />
      </label>
      <label class="theme-red">
        <span class="visually-hidden">red</span>
        <input type="radio" name="color" value="red" />
      </label>
      <label class="theme-orange">
        <span class="visually-hidden">orange</span>
        <input type="radio" name="color" value="orange" />
      </label>
      <label class="theme-yellow">
        <span class="visually-hidden">yellow</span>
        <input type="radio" name="color" value="yellow" />
      </label>
      <label class="theme-green">
        <span class="visually-hidden">green</span>
        <input type="radio" name="color" value="green" />
      </label>
      <label class="theme-blue">
        <span class="visually-hidden">blue</span>
        <input type="radio" name="color" value="blue" />
      </label>
      <label class="theme-indigo">
        <span class="visually-hidden">indigo</span>
        <input type="radio" name="color" value="indigo" />
      </label>
      <label class="theme-violet">
        <span class="visually-hidden">violet</span>
        <input type="radio" name="color" value="violet" />
      </label>
    </fieldset>
    <div class="input-group actions">
      <button type="submit" class="btn-primary" id="saveFermentButton">Save</button>
      <button type="button" aria-controls="saveFermentDialog" aria-haspopup="dialog" class="btn-default">Cancel</button>
    </div>
  </form>
</dialog>

<style>
  output {
    font-size: var(--font-size-lg);
    font-weight: 700;
  }
  :where(input, textarea) {
    background: none;
    border: 0;
    margin: 0;
    padding: 0;
    border-bottom: 1px solid var(--border-color);
    inline-size: 100%;
    color: var(--text-color);
    font-size: var(--font-size-lg);
  }
  :where(input, textarea):focus {
    outline: 0;
    background-color: rgba(255, 255, 255, 0.05);
  }
  label {
    font-size: var(--font-size-md);
    display: block;
  }
  input::placeholder {
    color: var(--text-color);
    opacity: 0.5;
  }
  .input-group:not(:first-child) {
    margin-top: 1em;
    position: relative;
  }
  .actions {
    display: flex;
    flex-direction: row-reverse;
    justify-content: flex-start;
    gap: 1rem;
  }
  fieldset {
    margin: 0;
    padding: 0;
    border: 0;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 1rem;
  }
  fieldset > label {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 1.5rem;
    height: 1.5rem;
    border-radius: 1.5rem;
  }
  fieldset > label:focus-within {
    outline: 2px solid var(--text-color);
  }
  legend {
    margin-block-end: 1rem;;
  }
  input[type="radio"] {
    margin: 0;
    padding: 0;
    width: 0.5rem;
    height: 0.5rem;
  }
  input[type="radio"]:checked {
    scale: 4.5;
  }
  .theme-red {
    background: red;
  }
  [value="transparent"] {
    accent-color: var(--border-color);
  }
  .theme-transparent {
    border: 2px solid var(--border-color);
  }
  [value="red"] {
    accent-color: red;
  }
  .theme-orange {
    background: orange;
  }
  [value="orange"] {
    accent-color: orange;
  }
  .theme-yellow {
    background: yellow;
  }
  [value="yellow"] {
    accent-color: yellow;
  }
  .theme-green {
    background: green;
  }
  [value="green"] {
    accent-color: green;
  }
  .theme-blue {
    background: blue;
  }
  [value="blue"] {
    accent-color: blue;
  }
  .theme-indigo {
    background: indigo;
  }
  [value="indigo"] {
    accent-color: indigo;
  }
  .theme-violet {
    background: violet;
  }
  [value="violet"] {
    accent-color: violet;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const saveFermentDialog = document.getElementById("saveFermentDialog");
    const saveFermentForm = document.querySelector("form#saveFermentForm");
    const addOneDay = date => {
      date.setDate(date.getDate() + 1);
      return date;
    }
    
    saveFermentDialog.addEventListener("cancel", () => {
      const date = new Date();
      const todaysdate = addOneDay(date).toISOString().split('T')[0];

      saveFermentForm.reset();
      dateEnd.setAttribute("min", todaysdate);
    });
    saveFermentDialog.addEventListener("close", () => {
      const date = new Date();
      const todaysdate = addOneDay(date).toISOString().split('T')[0];

      saveFermentForm.reset();
      dateEnd.setAttribute("min", todaysdate);
    });
  });
</script>